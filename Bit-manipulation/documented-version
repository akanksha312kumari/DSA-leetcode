import java.util.*;

/*
 * Class Name: bitManipulation
 * Purpose:
 * Demonstrates different bit manipulation operations such as
 * checking odd/even, accessing bits, setting/clearing bits,
 * counting set bits, and fast exponentiation.
 */
public class bitManipulation {

    /*
     * Checks whether a number is odd or even.
     * Uses the least significant bit (LSB).
     * If LSB = 0 → Even
     * If LSB = 1 → Odd
     */
    public static int checkOddEven(int n){
        int bitMask = 1;      // Binary: 0001
        return n & bitMask;   // AND with LSB
    }

    /*
     * Returns the value of the i-th bit of number n.
     * Creates a mask with 1 at i-th position and ANDs with n.
     */
    public static int getIthBit(int n, int i){
        int bitMask = 1 << i;   // Shift 1 to i-th position
        return (n & bitMask);   // Extract i-th bit
    }

    /*
     * Sets (makes 1) the i-th bit of number n.
     * OR operation ensures the bit becomes 1.
     */
    public static int setIthBit(int n, int i){
        int bitMask = 1 << i;   // Mask with 1 at i-th position
        return n | bitMask;     // Set the bit
    }

    /*
     * Clears (makes 0) the i-th bit of number n.
     * NOT of mask creates 0 at i-th position.
     */
    public static int clearIthBit(int n, int i){
        int bitMask = ~(1 << i); // Mask with 0 at i-th position
        return n & bitMask;      // Clear the bit
    }

    /*
     * Clears the last i bits of number n.
     * (~0) gives all 1s, shifting left by i makes last i bits 0.
     */
    public static int clearLastIBits(int n, int i){
        int bitMask = (~0) << i;
        return n & bitMask;
    }

    /*
     * Clears bits from index i to j (inclusive).
     * Combines two masks:
     * 1. Left part keeps bits after j
     * 2. Right part keeps bits before i
     */
    public static int clearRangeOfBits(int n, int i, int j){
        int a = (~0) << (j + 1); // Left mask: 111000...
        int b = (1 << i) - 1;    // Right mask: 000111...
        int bitMask = a | b;     // Combined mask
        return n & bitMask;
    }

    /*
     * Checks whether a number is a power of 2.
     * Power of 2 numbers have only one set bit.
     * n & (n - 1) = 0 → Power of 2
     */
    public static int checkPowerOf2(int n){
        int bitMask = n - 1;
        return n & bitMask;
    }

    /*
     * Counts the number of set (1) bits in n.
     * Repeatedly checks LSB and right shifts n.
     */
    public static int countSetBits(int n){
        int count = 0;
        int bitMask = 1;

        while(n > 0){
            // Check if LSB is 1
            if ((n & bitMask) == 1){
                count++;
            }
            n = n >> 1; // Move to next bit
        }
        return count;
    }

    /*
     * Computes a^n using fast (binary) exponentiation.
     * Reduces time complexity from O(n) to O(log n).
     */
    public static int fastExponen(int a, int n){
        int ans = 1;

        while (n > 0){
            // If current bit of n is 1, multiply result
            if ((n & 1) == 1){
                ans = ans * a;
            }
            a = a * a;   // Square the base
            n = n >> 1;  // Divide exponent by 2
        }
        return ans;
    }

    /*
     * Main method
     * Provides a menu-driven interface to perform bit operations.
     */
    public static void main(String args[]){
        Scanner sc = new Scanner(System.in);

        // Initial number input
        System.out.println("Enter the number: ");
        int n = sc.nextInt();

        int ans, i, j;

        do {
            // Display menu
            System.out.println("""
            Press 1 to check odd or even.
            Press 2 to get ith bit.
            Press 3 to set ith bit.
            Press 4 to clear ith bit.
            Press 5 to clear last i bits.
            Press 6 to clear range of bits.
            Press 7 to check if a number is power of 2.
            Press 8 to count set bits in a number.
            Press 9 to perform exponentiation.
            Press 10 to change the input number.
            Press 11 to exit.
            """);

            ans = sc.nextInt();

            switch (ans){
                case 1:
                    // Odd or Even check
                    if (checkOddEven(n) == 0)
                        System.out.println("The number is EVEN.");
                    else
                        System.out.println("The number is ODD.");
                    break;

                case 2:
                    // Get i-th bit
                    System.out.println("Enter the position of the bit:");
                    i = sc.nextInt();
                    System.out.println(getIthBit(n, i) == 0 ? "0" : "1");
                    break;

                case 3:
                    // Set i-th bit
                    System.out.println("Enter the position of the bit:");
                    i = sc.nextInt();
                    System.out.println(setIthBit(n, i));
                    break;

                case 4:
                    // Clear i-th bit
                    System.out.println("Enter the position of the bit:");
                    i = sc.nextInt();
                    System.out.println(clearIthBit(n, i));
                    break;

                case 5:
                    // Clear last i bits
                    System.out.println("Enter the number of bits to remove from last:");
                    i = sc.nextInt();
                    System.out.println(clearLastIBits(n, i));
                    break;

                case 6:
                    // Clear range of bits
                    System.out.println("Enter the starting index:");
                    i = sc.nextInt();
                    System.out.println("Enter the ending index:");
                    j = sc.nextInt();
                    System.out.println(clearRangeOfBits(n, i, j));
                    break;

                case 7:
                    // Check power of 2
                    if (checkPowerOf2(n) == 0)
                        System.out.println("Yes it is a power of two.");
                    else
                        System.out.println("No it is not a power of two.");
                    break;

                case 8:
                    // Count set bits
                    System.out.println("The number of set bits are: " + countSetBits(n));
                    break;

                case 9:
                    // Fast exponentiation
                    System.out.println("Enter the power:");
                    int m = sc.nextInt();
                    System.out.println(fastExponen(n, m));
                    break;

                case 10:
                    // Change input number
                    System.out.println("Enter the number:");
                    n = sc.nextInt();
                    break;
            }

        } while (ans != 11); // Exit when user selects 11
    }
}
